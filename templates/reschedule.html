<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Zmiana terminu wizyty</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
</head>
<body>
<nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">Przychodnia Medyczna</a>
        <a class="btn btn-light btn-sm" href="/slots">Dostępne terminy</a>
    </div>
</nav>

<div class="container">
    <div class="card p-4 shadow-sm mb-4">
        <h3 class="mb-3">Zmiana terminu wizyty</h3>

        <p>
            <strong>Pacjent:</strong> {{ appointment.patient_name }}<br>
            <strong>Lekarz:</strong> {{ appointment.doctor_name }}<br>
            <strong>Obecny termin:</strong>
            {{ appointment.date }} {{ appointment.time }}
        </p>

        <form id="date-form" class="row g-2 mb-3"
              method="get"
              action="/reschedule/{{ appointment.id }}">
            <div class="col-md-4">
                <label class="form-label">Nowa data</label>
                <input
                    class="form-control"
                    type="date"
                    name="date"
                    value="{{ selected_date }}"
                >
            </div>
        </form>

        {% if slots|length == 0 %}
            <div class="alert alert-warning mt-3">
                Brak wolnych terminów dla wybranej daty.
            </div>
        {% else %}
            <div class="list-group mt-3">
                {% for s in slots %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ s.time }}</strong>
                            <small class="text-muted"> — {{ s.date }}</small>
                        </div>
                        <form method="post" action="/reschedule/{{ appointment.id }}">
                            <input type="hidden" name="slot_id" value="{{ s.slot_id }}">
                            <input type="hidden" name="date" value="{{ selected_date }}">
                            <button class="btn btn-secondary btn-sm" type="submit">
                                Zmień na ten termin
                            </button>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <a href="/slots" class="btn btn-outline-secondary">Wróć do dostępnych terminów</a>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("date-form");
        if (!form) return;

        const dateInput = form.querySelector('input[name="date"]');

        function submitForm() {
            form.submit();
        }

        if (dateInput) {
            dateInput.addEventListener("change", submitForm);
        }
    });
</script>

</body>
</html>
